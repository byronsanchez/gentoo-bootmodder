# Gentoo Bootmodder Scripts

This repository contains a set of tools designed to modify the gentoo minimal
install cd. I use these tools to create bootable images packaged with autoinstall
scripts- on boot, the gentoo installation automatically takes place with my
specified configurations for partitioning, packages to install, etc. Though, you
can use these tools to modify the iso however you'd like.

The following boot methods are currently supported:

  - USB 
  - PXE

The basic steps of the modification process:

  1. Download the latest Gentoo minimal install iso
  2. Modify the contents of the iso so that the installation will take place
  automatically
  3. Package the modified iso contents into a bootable media format (PXE, USB,
  etc).

These steps are handled by the main scripts:

  - `import.sh`
  - `package.sh`

Mods are handled manually by placing them in a `mods` directory.

### import.sh

The script used to import bootable isos into a modifiable workspace. These
workspaces are known as "provision profiles." Provision profiles are just
directories containing the contents of an iso in an organized workspace.

To import a local file and give it a custom profile name:

    ./import.sh -i /path/to/file.iso -n profile-name

To import a file from the internet:

    ./import.sh -i http://example.com/file.iso -n profile-name

### package.sh

This script is used to build bootable media based on the contents of a provision
profile. Basically, it overlays all mods on top of the original iso and builds a
bootable device from that.

To package the workspace into a bootable pxe device:

    ./package.sh -n profile-name -p

Or a bootable usb device:

    ./package.sh -n profile-name -u

Or both:

    ./package.sh -n profile-name -u -p

Bootable devices will be written to:

    ${root_project}/profiles/profile-name/devices/

### Mods

Mods **overlay** original source extracts.

Here's an example.

The original minimal install cd contains a file with path:

    /etc/hosts

You place a file in the mods directory with path:

    ./mods/squashfs/etc/hosts

`package.sh` will copy the files from the mods directory and place it in the
final packaged device. Thus `./mods/squashfs/etc/hosts` will overwrite the
original `/etc/hosts` file.

The original source extracts are not touched (but the generated device will have
the modifications applied). The original source extracts are left in tact.  This
makes it possible to continously apply mods and use the `package.sh` script
without any surprising consequences. `package.sh` accomplishes this by copying
the source extracts to a temporary build directory. It then overlays the mods on
top of that copy.  Finally, the script will perform all the necessary operations
to build the bootable device(s) of your choice.

## Available mod directories

The mod directory of each provision profile is located at:

    ${root_project}/profiles/profile-name/mods/

A global mod directory is located at:

    ${root_project}/mods/

Global mods are applied to all bootable devices generated by any provision
profile. Profile-specific mods are only applied to bootable devices generated
with that provision profile. Profile-specific mods take precedence over global
mods- if the same file is defined in both, the profile-specific mod will
overwrite the global mod.

### Mod Types

There are three mod types:

  - bootloader mods - used to modified the boot directory and configuration of
    an iso
  - initramfs mods - used to modify the contents of the cpio image
  - squashfs mods - used to modify the actual filesystem

These are denoted by the `mods` directory structure- simply place your mods in
the appropriate target directory:

  - `mods/bootloader-${device}`
  - `mods/initramfs`
  - `mods/squashfs`

Since there can be multiple types of bootloaders, the bootloader directory
naming convention is `bootloader-${device}.` Thus, for a usb bootloader, the
directory name would be `bootloader-usb`. For a pxe bootloader, the directory
name would be `bootloader-pxe`.

# Dependencies

These scripts depend on the following packages:

  - syslinux
  - squashfs-tools
  - cdrtools

# Limitations

The resulting network bootable ramdisk will be several hundred megabytes, thus
it will not be suitable for over-the-internet network installation.

There are probably lots of other limitations due to the fact that I designed
this with my own use case in mind. So if there's anything you'd like to see
added, improved or whatever, feel free to let me know.

